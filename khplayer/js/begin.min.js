const aniSpeed="fast",replace_html=(e,t,n)=>{$(e).fadeOut(n,()=>$(e).html(t).fadeIn(n))},aniAppendTo=(e,t,n)=>{null==n&&(n="normal"),$(e).css({display:"none"}).appendTo(t).show(n)},UNIQUE_ID="_"+Date.now(),SELECT_RES=e=>{let t=$(e).parent(".dropdown-menu").parent("#qualitySelectorContainer").find("#qualitySelectorBtn"),n=$(e).html();replace_html(t,n,aniSpeed),t.attr("selected-res",$(e).attr("res-data"))};$("#qualitySelectorContainer .dropdown-item").attr("onclick","SELECT_RES(this)");const SELECT_TYPE=e=>{let t=$(e).parent(".dropdown-menu").parent("#typeSelectorContainer").find("#typeSelectorBtn"),n=$(e).html();replace_html(t,n,aniSpeed),t.attr("selected-type",$(e).attr("type-data"))};$("#typeSelectorContainer .dropdown-item").attr("onclick","SELECT_TYPE(this)"),aniAppendTo($("#templateSkeleton .episode_container").clone(),"#user_interact_section"),$(".showin").attr("style","display:none"),$(".showin").show(aniSpeed),$("#templateSkeleton #sourceWarpper #singleSrcContainer").clone().appendTo("#templateSkeleton #temp_zone"),$("#temp_zone #addSourceBtn").attr("onclick","$(this).parent('#singleSrcContainer').hide(aniSpeed).delay(10).queue(() => $(this).remove())").removeAttr("id").html("➖");const addSrcBtnFn=e=>{let t=$("#temp_zone #singleSrcContainer").clone(),n=$(e).parent("#singleSrcContainer").parent("#sourceWarpper");aniAppendTo(t,n,aniSpeed)};$("#templateSkeleton #captionContainer .singleCapElem").clone().appendTo("#templateSkeleton #temp_zone"),$("#temp_zone #addCaptionBtn").attr("onclick","$(this).parent('.singleCapElem').hide(aniSpeed).delay(10).queue(()=>$(this).remove())").removeAttr("id").html("➖");const addCapBtnFn=e=>{let t=$("#temp_zone .singleCapElem").clone(),n=$(e).parent(".singleCapElem").parent("#captionContainer");aniAppendTo(t,n,aniSpeed)};$("#templateSkeleton #addEpBtn").clone().appendTo("#templateSkeleton .addRemoveEpBtn");const REMOVE_EPISODE=e=>$(e).parent(".addRemoveEpBtn").parent(".episode_container").hide(aniSpeed).delay(10).queue(()=>$(this).remove());$("#templateSkeleton #addEpBtn:nth-child(2)").removeAttr("id").attr("onclick","REMOVE_EPISODE(this)").html("➖");const ADD_EPISODE=e=>{$(e).parent(".addRemoveEpBtn").parent(".episode_container").after($("#templateSkeleton .episode_container").clone()).next().show(aniSpeed)},generate_code=e=>{$("#exportedDataFrame").hide(aniSpeed);const t=[];$("#user_interact_section .episode_container").each((e,n)=>{if(""!=$(n).find("#title").val()){let e={},a=$(n).find("#captionContainer").find(".singleCapElem").find("#captionFullName").val(),o=$("#masterPosterInput").val(),i=$(n).find(".essentials").find("#poster").val();e.title=$(n).find("#title").val(),e.type="video",e.sources=[],finalMasPoster=""!=o?o:"https://dngnd.ml/khp-poster",$(n).find("#sourceWarpper").find(".input-group").each((t,n)=>{let a={},o=$(n).find("#typeSelectorContainer").find("#typeSelectorBtn").attr("selected-type");a.src=$(n).find("#mediaSrc").val();let i=$(n).find("#qualitySelectorContainer").find("#qualitySelectorBtn").attr("selected-res");a.size=null!=i?parseInt(i):1080,a.type="undefined"!=o?o:"video/mp4",e.sources.push(a)}),finalEpPoster=""!=i?i:finalMasPoster,e.poster=finalEpPoster,""!=a&&(e.tracks=[],$(n).find("#captionContainer").find(".singleCapElem").each((t,n)=>{let a={kind:"subtitles"};a.label=$(n).find("#captionFullName").val(),a.srclang=$(n).find("#captionShortName").val(),a.src=$(n).find("#capionSrc").val(),e.tracks.push(a)})),t.push(e)}}),t.push(finalEpPoster);let n=JSON.stringify(t).replace(/"(\w+)"\s*:/g,"$1:"),a=`&#x3C;script src=&#x22;https://dngnd.ml/khplayer-js&#x22; uniqueID="${UNIQUE_ID}"&#x3E;&#x3C;script&#x3E;`,o="&#x3C;script src=&#x22;https://dngnd.ml/latest-jquery&#x22;&#x3E;&#x3C;/script&#x3E;",i=`&#x3C;div id=&#x22;${UNIQUE_ID}&#x22;&#x3E;&#x3C;/div&#x3E;<br><br>\n    &#x3C;script&#x3E;<br>var ${UNIQUE_ID}_=${n}<br>&#x3C;/script&#x3E;<br><br>\n    ${o}<br>${a}`,l="COMMING SOON !!!";switch(e){case"input_data":$("#exportedData").html(n),$("#downloadExpData").show(aniSpeed);break;case"full_code":$("#exportedData").html(i),$("#downloadExpData").hide(aniSpeed);break;case"isolated":$("#exportedData").html(l),$("#downloadExpData").hide(aniSpeed);break;default:console.log(new Error("wrong request type"))}$("#exportedDataFrame").show(aniSpeed),$("html, body").animate({scrollTop:$(document).height()},aniSpeed)};$("#genBtnData").on("click",()=>{generate_code("input_data")}),$("#genBtnFullCode").on("click",()=>{generate_code("full_code")}),$("#genBtnIsolated").on("click",()=>{alert('Tính năng này sắp tới sẽ có. Các chế độ generate code kia đều phải load 4 file rời (2 file css, 2 file js của Plyr và K.H.Player phần playlist), điều này làm tăng thời gian load khung player từ 1 đến 2 giây nhưng trông gọn hơn. Code " Cách ly " sẽ generate ra đoạn code hoàn toàn độc lập, kể cả mình xóa 4 file kia đi thì code vẫn dùng bình thường.'),generate_code("isolated")}),new ClipboardJS("#copyCodeToCB"),document.getElementById("downloadExpData").addEventListener("click",()=>{let e=$("#exportedData").html(),t=prompt("Nhập tên file"),n=new Blob([e],{type:"text/javascript;charset=utf-8"});saveAs(n,t)});